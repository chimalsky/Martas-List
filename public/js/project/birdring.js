(()=>{"use strict";var t={name:"year",children:[{name:"spring",children:[{name:"march",value:1},{name:"april",value:1},{name:"may",value:1}]},{name:"summer",children:[{name:"june",value:1},{name:"july",value:1},{name:"august",value:1}]},{name:"fall",children:[{name:"september",value:1},{name:"october",value:1},{name:"november",value:1}]},{name:"winter",children:[{name:"december",value:1},{name:"january",value:1},{name:"february",value:1}]}]};d3.scaleSequential().domain([1,20]).interpolator(d3.interpolateViridis);var n=d3.scalePow().exponent(.5).domain([0,12e3]).range([5,12]);d3.scalePow().exponent(2).domain([0,12e3]).range([5,12]),d3.scalePow().exponent(.8).domain([0,12e3]).range([1,20]);function e(t,e){t.attr("width",900).attr("height",340);new Array(3);var r=[],a={null:0,arriving:1,departing:2},i=["red","orange","blue"];e.forEach((function(t){var e,i=null!==(e=t.migratoryStatus)&&void 0!==e?e:"null",o=a[i],u={cluster:o,radius:n(t.bodymass),x:200*Math.cos(o/3*2*Math.PI)+450+Math.random(),y:200*Math.sin(o/3*2*Math.PI)+170+Math.random()};r.push(u)}));var o=d3.forceSimulation(r).force("x",d3.forceX(450).strength(1)).force("y",d3.forceY(170).strength(1)).force("charge",d3.forceManyBody().strength(-100)).force("collision",d3.forceCollide().radius((function(t){return t.radius})).strength(.2)),u=t.selectAll("circle").data(r,(function(t){return t.id})).join((function(t){return t.append("circle").attr("id",(function(t){return t.id})).attr("fill",(function(t){return i[t.cluster]})).transition().duration(3e3).attr("r",(function(t){return t.radius})).attr("cx",(function(t,n){return t.x/3})).attr("cy",(function(t){return t.y/3}))}),(function(t){return t.transition().duration(3e3).attr("fill",(function(t){return i[t.cluster]}))}),(function(t){return t.transition().duration(750).remove()}));o.on("tick",(function(){u.attr("transform",(function(t){return"translate(".concat(t.x+1,",").concat(t.y+1,")")}))}))}var r,a=d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow,t.children.length+1)),i=d3.arc().startAngle((function(t){return t.x0})).endAngle((function(t){return t.x1})).padAngle((function(t){return Math.min(t.x1-t.x0,.02)})).padRadius(10).innerRadius((function(t){return 75*t.y0})).outerRadius((function(t){return Math.max(75*t.y0,75*t.y1-1)})),o=function(t){return t.y1<=3&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.03};function u(){var n=function(){var n=d3.hierarchy(t).sum((function(t){return t.value})).sort((function(t,n){return n.value-t.value}));return d3.partition().size([2*Math.PI,n.height+1])(n)}().each((function(t){return t.current=t}));console.log(n);var e=d3.select("#birdring").append("svg").attr("viewBox",[0,0,900,900]).attr("fill","white").append("g").attr("transform","translate(".concat(450,",").concat(270,")")),r=e.append("g").selectAll("path").data(n.descendants()).join((function(t){t.append("path").style("cursor","pointer").attr("data-chrono",(function(t){return t.data.name})).attr("fill",(function(t){for(;t.depth>1;)t=t.parent;return a(t.data.name)})).attr("fill-opacity",(function(t){return function(t){return t.y1<=3&&t.y0>=1&&t.x1>t.x0}(t.current)?t.children?.6:.4:0})).attr("d",(function(t){return i(t.current)})).on("mouseover",(function(t,n){var e=d3.select(this);e.attr("original-fill",e.attr("fill")),e.attr("fill","orange")})).on("mouseout",(function(t,n){var e=d3.select(this);e.attr("fill",e.attr("original-fill"))})).on("click",c)}));r.filter((function(t){return t.children})).style("cursor","pointer").on("click",c);var u=e.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").selectAll("text").data(n.descendants()).join((function(t){return t.append("text").attr("dy","0.35em").attr("fill","#333").attr("fill-opacity",(function(t){return+o(t.current)})).attr("transform",(function(t){return function(t){var n=(t.x0+t.x1)/2*180/Math.PI,e=(t.y0+t.y1)/2*75;return"rotate(".concat(n-90,") translate(").concat(e,",0) rotate(").concat(n<180?0:180,")")}(t.current)})).style("text-transform","capitalize").style("font-size","28px").text((function(t){return t.data.name.slice(0,3)}))}));function c(t,r){window.dispatchEvent(new CustomEvent("chronoSelected",{detail:r})),n.each((function(t){return t.target={x0:2*Math.max(0,Math.min(1,(t.x0-r.x0)/(r.x1-r.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(t.x1-r.x0)/(r.x1-r.x0)))*Math.PI,y0:Math.max(0,t.y0-r.depth),y1:Math.max(0,t.y1-r.depth)}}));var a=e.transition().duration(700);0===r.depth&&l(a),1===r.depth&&l(a)}function l(t){r.transition(t).tween("data",(function(t){var n=d3.interpolate(t.current,t.target);return function(e){return t.current=n(e)}})).attrTween("d",(function(t){return function(){return i(t.current)}})),u.filter((function(t){return+this.getAttribute("fill-opacity")||o(t.target)})).transition(t)}}document.addEventListener("turbolinks:load",(function(){u();var t=document.querySelector("#selectedDatum"),n=(d3.select("#birdhorizon"),d3.select("#birdhorizoncanvas"));document.querySelector("#play"),document.querySelector("#pause");window.addEventListener("chronoSelected",(function(a){var i;r=a.detail.data.name,t.innerHTML=r,(i=r,fetch("/project/digital-object/birdring/fetch?chrono=".concat(i))).then((function(t){return t.json()})).then((function(t){var r=[];for(var a in t)r.push(t[a]);e(n,r)}))}))}))})();