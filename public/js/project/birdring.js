!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=2)}({2:function(t,e,n){t.exports=n("jK9/")},"jK9/":function(t,e,n){"use strict";n.r(e);var r={name:"year",children:[{name:"spring",children:[{name:"march",value:1},{name:"april",value:1},{name:"may",value:1}]},{name:"summer",children:[{name:"june",value:1},{name:"july",value:1},{name:"august",value:1}]},{name:"fall",children:[{name:"september",value:1},{name:"october",value:1},{name:"november",value:1}]},{name:"winter",children:[{name:"december",value:1},{name:"january",value:1},{name:"february",value:1}]}]};function a(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e,n){e.width=740,e.height=300;var r=e.getContext("2d");t.attr("width",740).attr("height",300);var o=[];for(var i in n)console.log(n[i]),o.push([i,n[i]]);var c=d3.scaleSequential().domain([1,10]).interpolator(d3.interpolateViridis),u=o.map(Object.create),l=(d3.scaleLinear().domain([0,o.length]).range([0,740]),d3.scaleLinear().domain([0,o.length]).range([300,0]),d3.scalePow().exponent(.5).domain([0,12e3]).range([5,24])),d=d3.scalePow().exponent(.8).domain([0,12e3]).range([1,12]);d3.forceSimulation(u).alphaTarget(.1).velocityDecay(.05).force("x",d3.forceX().strength(1e-6)).force("y",d3.forceY().strength(2e-4)).force("collide",d3.forceCollide().radius((function(t){return 2*l(f(t).bodymass)})).iterations(1)).force("charge",d3.forceManyBody().strength((function(t){return d(f(t).bodymass)}))).on("tick",(function(){r.clearRect(0,0,740,300),r.save(),r.translate(370,150);var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=a(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){u=!0,i=t},f:function(){try{c||null==n.return||n.return()}finally{if(u)throw i}}}}(u);try{for(e.s();!(t=e.n()).done;)n=void 0,o=void 0,i=void 0,d=void 0,o=t.value,i=f(o),d=l(Number(i.bodymass)),r.beginPath(),r.moveTo(o.x+d,o.y),r.arc(o.x,o.y,d,0,2*Math.PI),r.fillStyle=(n=1,"departing"===i.migratoryStatus?n=8:"arriving"===i.migratoryStatus&&(n=10),c(n)),r.fill()}catch(t){e.e(t)}finally{e.f()}var n,o,i,d;r.restore()}));function f(t){return o[t.index][1]}}var c=d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow,r.children.length+1)),u=d3.arc().startAngle((function(t){return t.x0})).endAngle((function(t){return t.x1})).padAngle((function(t){return Math.min((t.x1-t.x0)/2,.039)})).padRadius(15.625).innerRadius((function(t){return 78.125*t.y0})).outerRadius((function(t){return Math.max(78.125*t.y0,78.125*t.y1-1)})),l=function(t){return t.y1<=3&&t.y0>=1&&t.x1>t.x0},d=function(t){return t.y1<=3&&t.y0>=1&&(t.y1-t.y0)*(t.x1-t.x0)>.03},f=function(t){var e=(t.x0+t.x1)/2*180/Math.PI,n=(t.y0+t.y1)/2*78.125;return"rotate(".concat(e-90,") translate(").concat(n,",0) rotate(").concat(e<180?0:180,")")},s=d3.format(",d");function m(){var t=function(){var t=d3.hierarchy(r).sum((function(t){return t.value})).sort((function(t,e){return e.value-t.value}));return d3.partition().size([2*Math.PI,t.height+1])(t)}();t.each((function(t){return t.current=t}));var e=d3.select("#birdring").append("svg").attr("viewBox",[0,0,500,500]).attr("fill","white").style("font","12px sans-serif").append("g").attr("transform","translate(".concat(250,",").concat(250,")")),n=e.append("g").selectAll("path").data(t.descendants().slice(1)).join("path").style("cursor","pointer").attr("fill",(function(t){for(;t.depth>1;)t=t.parent;return c(t.data.name)})).attr("fill-opacity",(function(t){return l(t.current)?t.children?.6:.4:0})).attr("d",(function(t){return u(t.current)})).on("mouseover",(function(t,e){var n=d3.select(this);n.attr("original-fill",n.attr("fill")),n.attr("fill","orange")})).on("mouseout",(function(t,e){var n=d3.select(this);n.attr("fill",n.attr("original-fill"))})).on("click",i);n.filter((function(t){return t.children})).style("cursor","pointer").on("click",i),n.append("title").text((function(t){return"".concat(t.ancestors().map((function(t){return t.data.name})).reverse().join("/"),"\n").concat(s(t.value))}));var a=e.append("g").attr("pointer-events","none").attr("text-anchor","middle").style("user-select","none").selectAll("text").data(t.descendants().slice(1)).join("text").attr("dy","0.35em").attr("fill","#333").attr("fill-opacity",(function(t){return+d(t.current)})).attr("transform",(function(t){return f(t.current)})).style("text-transform","capitalize").text((function(t){return t.data.name})),o=e.append("circle").datum(t).attr("r",78.125).attr("pointer-events","all").attr("text-anchor","middle").style("cursor","pointer").on("click",i).append("g").append("text").text("foo").attr("dx",-20).attr("fill","black");function i(n,r){window.dispatchEvent(new CustomEvent("chronoSelected",{detail:r})),o.datum(r.parent||t),t.each((function(t){return t.target={x0:2*Math.max(0,Math.min(1,(t.x0-r.x0)/(r.x1-r.x0)))*Math.PI,x1:2*Math.max(0,Math.min(1,(t.x1-r.x0)/(r.x1-r.x0)))*Math.PI,y0:Math.max(0,t.y0-r.depth),y1:Math.max(0,t.y1-r.depth)}}));var a=e.transition().duration(700);0===r.depth&&m(a),1===r.depth&&(m(a),o.select("text").attr("opacity",1))}function m(t){n.transition(t).tween("data",(function(t){var e=d3.interpolate(t.current,t.target);return function(n){return t.current=e(n)}})).filter((function(t){return+this.getAttribute("fill-opacity")||l(t.target)})).attr("fill-opacity",(function(t){return l(t.target)?t.children?.6:.4:0})).attrTween("d",(function(t){return function(){return u(t.current)}})),a.filter((function(t){return+this.getAttribute("fill-opacity")||d(t.target)})).transition(t).attr("fill-opacity",(function(t){return+d(t.target)})).attrTween("transform",(function(t){return function(){return f(t.current)}}))}}document.addEventListener("turbolinks:load",(function(){m();var t=document.querySelector("#selectedDatum"),e=d3.select("#birdhorizon"),n=document.querySelector("#birdhorizoncanvas");window.addEventListener("chronoSelected",(function(r){var a,o=r.detail.data.name;t.style.opacity=.25,t.innerHTML=o,setTimeout((function(){t.style.opacity=1}),300),(a=o,fetch("/project/digital-object/birdring/fetch?chrono=".concat(a))).then((function(t){return t.json()})).then((function(t){i(e,n,t)}))}))}))}});